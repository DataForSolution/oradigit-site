<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} | OraDigit</title>
  <meta name="description" content="{{ page.description | default: 'OraDigit â€“ Anchored in Trust. Driven by Data.' }}">
  <link rel="icon" href="{{ '/assets/logo.png' | relative_url }}" type="image/png">
  <link rel="stylesheet" href="{{ '/assets/css/style.css?v=2' | relative_url }}">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
   <!-- 1) Google Tag Manager (Head snippet) -->
  <script>
    (function(w,d,s,l,i){
      w[l]=w[l]||[]; w[l].push({'gtm.start': new Date().getTime(), event:'gtm.js'});
      var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s), dl=l!='dataLayer'?'&l='+l:'';
      j.async=true;
      j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
      f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GT-PJWHFQQ4');
  </script>
  <!-- End Google Tag Manager -->

  <!-- 2) Google tag (gtag.js) with Consent Mode -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FKVXD8061R"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }

    // Start with analytics denied until user consents
    gtag('consent','default',{ analytics_storage:'denied' });

    // Load GA4
    gtag('js', new Date());
    gtag('config','G-FKVXD8061R',{ send_page_view:true });
  </script>

  <!-- 3) Osano CookieConsent banner -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js"></script>
  <script>
    console.log("ðŸ›  CookieConsent loaded:", !!window.cookieconsent);
    window.addEventListener("load", function() {
      if (!window.cookieconsent) {
        console.error("CookieConsent library not found!");
        return;
      }
      console.log("ðŸ›  Initializing CookieConsentâ€¦");
      window.cookieconsent.initialise({
        palette: {
          popup:  { background: "#2a2a2a" },
          button: { background: "#4e503b" }
        },
        theme: "classic",
        type:  "opt-in",
        content: {
          message: "We use analytics cookies to improve your experience. Do you accept?",
          dismiss: "Accept all",
          deny:    "Decline",
          link:    "Learn more",
          href:    "/privacy"
        },
        onInitialise: function(status) {
          console.log("ðŸ›  Cookie status:", status);
          gtag('consent','default',{
            analytics_storage: status === 'allow' ? 'granted' : 'denied'
          });
        },
        onStatusChange: function(status) {
          console.log("ðŸ›  Cookie status changed to:", status);
          gtag('consent','update',{
            analytics_storage: status === 'allow' ? 'granted' : 'denied'
          });
        }
      });
    });
  </script>

</head>
<body>
  <!-- 4) Google Tag Manager (noscript fallback) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GT-PJWHFQQ4"
            height="0" width="0"
            style="display:none;visibility:hidden"></iframe>
  </noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- â€¦rest of your body contentâ€¦ -->

  {% include navigation.html %}
  <main class="page-content">
    {{ content }}
  </main>
  {% include footer.html %}
 <!-- Back to Top Button -->
<button id="backToTop" title="Back to Top">â†‘</button>

<script>
  // Show/hide back to top button
  const backToTop = document.getElementById("backToTop");

  window.onscroll = function () {
    if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
      backToTop.style.display = "block";
    } else {
      backToTop.style.display = "none";
    }
  };

  backToTop.onclick = function () {
    window.scrollTo({ top: 0, behavior: "smooth" });
  };
</script>
  <!-- â€¦your existing page contentâ€¦ -->
 
   <!-- Chatbot Widget -->
    <!-- Chatbot Widget -->
  <div id="chatbot-container">
    <button id="chatbot-toggle" aria-label="Chat with us!">ðŸ’¬</button>
    <div id="chatbot-box" class="hidden">
      <div id="chatbot-header">OraDigit Assistant</div>
      <div id="chatbot-messages"></div>
      <div id="chatbot-controls" style="display:flex; gap:0.5em; padding:0.5em;">
        <input id="chatbot-input"
               placeholder="Ask me anythingâ€¦"
               autocomplete="off"
               style="flex:1;"/>
        <button id="chatbot-send">Send</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      // Use your Firebaseâ€hosted function on your custom domain
      const CHAT_URL = "https://auth.oradigit.com/chat";
      console.log("ðŸ›  Widget loadedâ€”CHAT_URL =", CHAT_URL);

      const toggleBtn = document.getElementById('chatbot-toggle');
      const box       = document.getElementById('chatbot-box');
      const input     = document.getElementById('chatbot-input');
      const sendBtn   = document.getElementById('chatbot-send');
      const messages  = document.getElementById('chatbot-messages');

      // 1) Toggle the chat window
      toggleBtn.addEventListener('click', () => {
        box.classList.toggle('hidden');
        gtag('event', 'chatbot_open', { widget: 'ora-digit-assistant' });
      });

      // 2) Common send logic
      async function sendMessage() {
        const prompt = input.value.trim();
        if (!prompt) return;
        gtag('event', 'chatbot_send', {
        prompt_length: prompt.length,
        widget: 'assistant'
      });

        messages.innerHTML += `<div><strong>You:</strong> ${prompt}</div>`;
        input.value = '';
        messages.scrollTop = messages.scrollHeight;

        try {
          const res = await fetch(CHAT_URL, {
            method:  'POST',
            mode:    'cors',
            headers: { 'Content-Type': 'application/json' },
            body:    JSON.stringify({ prompt })
          });
          console.log("ðŸ›  fetch status:", res.status);
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          const { reply } = await res.json();
          gtag('event', 'chatbot_reply', {
          reply_length: reply.length,
          widget: 'assistant'
        });
          messages.innerHTML += `<div><strong>Assistant:</strong> ${reply}</div>`;
          messages.scrollTop = messages.scrollHeight;
        } catch (err) {
          console.error("ðŸ›  chat error:", err);
          gtag('event', 'chatbot_error', {
          error_message: err.message,
          widget: 'assistant'
        });
          messages.innerHTML +=
            `<div style="color:red;"><strong>Error:</strong> ${err.message}</div>`;
          messages.scrollTop = messages.scrollHeight;
        }
      }

      // 3) Send on Enter
      input.addEventListener('keydown', e => {
        if (e.key === 'Enter') sendMessage();
      });
      // 4) Send on button click
      sendBtn.addEventListener('click', sendMessage);
    })();
  </script>
</body>
</html>
