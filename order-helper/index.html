---
layout: default
title: OraDigit Order Helper (Updated)
permalink: /order-helper/
description: Evidence-based PET/CT, CT, and MRI order helper with validation and export. No PHI. Educational use only.
---

<!-- Page-scoped assets & config -->
<link rel="stylesheet" href="{{ '/order-helper/style.css' | relative_url }}?v=20250922">
<meta name="oh-version" content="20250922">

<!-- Error beacon: surface JS errors in the status bar -->
<script>
  window.addEventListener('error', e => {
    const s = document.getElementById('status');
    if (s) {
      s.textContent = 'JavaScript error: ' + (e.message || 'Unknown');
      s.className = 'status error';
    }
  });
  window.addEventListener('unhandledrejection', e => {
    const s = document.getElementById('status');
    if (s) {
      s.textContent = 'App error: ' + (e.reason?.message || e.reason || 'Unknown');
      s.className = 'status error';
    }
  });
</script>

<section class="order-helper container" aria-labelledby="oh-title">
  <header class="oh-header">
    <h1 id="oh-title">OraDigit Order Helper</h1>
    <p class="lead">
      Structure clear, payer-ready imaging orders. Select modality and context; we’ll generate
      a professional clinical indication and surface prep/flags. All client-side. No PHI.
    </p>
    <div id="status" class="status" role="status" aria-live="polite"></div>
    <div id="rulesErrors" class="status error" style="display:none"></div>
  </header>

  <div class="oh-grid">
    <!-- ================= LEFT: FORM ================= -->
    <form id="orderForm" class="oh-form" novalidate>
      <!-- Modality -->
      <div class="field">
        <label for="modality">Modality <span aria-hidden="true">*</span></label>
        <select id="modality" name="modality" required>
          <option value="">Select…</option>
          <option value="PET/CT" selected>PET/CT</option>
          <option value="CT">CT</option>
          <option value="MRI">MRI</option>
        </select>
        <small class="hint">Regions, contexts, and conditions adapt to your selection.</small>
      </div>

      <!-- Region -->
      <div class="field">
        <label for="region">Region <span aria-hidden="true">*</span></label>
        <select id="region" name="region" required></select>
      </div>

      <!-- Context (chips UI expected by app.fs.js) -->
      <div class="field">
        <label>Context <span aria-hidden="true">*</span></label>

        <!-- Chips rendered dynamically by app.fs.js -->
        <div id="contextChips" class="oh-chips" role="group" aria-label="Context"></div>

        <!-- Hidden mirror for compatibility (app.fs.js keeps in sync) -->
        <select id="context" name="context" multiple hidden></select>

        <small class="hint">Click one or more (e.g., staging, restaging, surveillance, acute, follow-up).</small>
      </div>

      <!-- Condition (with datalist suggestions) -->
      <div class="field">
        <label for="condition">Condition</label>
        <input id="condition" name="condition" list="conditionList" placeholder="e.g., NSCLC, renal colic, PE, appendicitis"/>
        <datalist id="conditionList"></datalist>
        <small class="hint">Start typing to see common conditions for the chosen modality.</small>
      </div>

      <!-- Contrast (CT only; shown/hidden by JS) -->
      <fieldset id="contrastGroup" class="oh-contrast hidden">
        <legend>CT Contrast</legend>
        <label class="inline"><input type="radio" name="contrast" value="with_iv"> With IV contrast</label>
        <label class="inline"><input type="radio" name="contrast" value="without_iv"> Without IV contrast</label>
        <label class="inline"><input type="checkbox" id="oralContrast" value="oral"> Add oral contrast (abd/pelvis)</label>
        <small class="hint">We’ll auto-suggest based on condition (e.g., “renal colic” → without IV; “PE/CTA” → with IV).</small>
      </fieldset>

      <!-- Indication (auto-built but editable) -->
      <div class="field">
        <label for="indication">Clinical Indication</label>
        <textarea id="indication" name="indication" rows="3" placeholder="Auto-generated (you can edit)…"></textarea>
      </div>

      <div class="actions">
        <button type="submit" class="btn-primary">Suggest Order</button>
        <button type="button" id="copyIndication" class="btn-ghost" aria-label="Copy clinical indication">Copy Indication</button>
        <span id="errMsg" role="alert" class="muted"></span>
        <div id="dbg" aria-live="polite" class="muted" style="font-size:12px"></div>
      </div>
    </form>

    <!-- ================= RIGHT: PREVIEW / SUGGESTIONS ================= -->
    <aside class="oh-aside" aria-label="Order preview and suggestions">
      <div class="card">
        <h2>Order Preview</h2>
        <div class="preview">
          <div><strong>Modality:</strong> <span id="pv-modality">—</span></div>
          <div><strong>Region:</strong> <span id="pv-region">—</span></div>
          <div><strong>Context:</strong> <span id="pv-context">—</span></div>
          <div><strong>Condition:</strong> <span id="pv-condition">—</span></div>
          <div><strong>Contrast:</strong> <span id="pv-contrast">—</span></div>
          <hr>
          <div><strong>Clinical Indication</strong></div>
          <pre id="pv-indication" class="indication-box">—</pre>
        </div>
      </div>

      <div class="card">
        <h2>Suggested Studies</h2>
        <ul id="suggestions" class="suggest-list" aria-live="polite">
          <li class="muted">Suggestions will appear when available.</li>
        </ul>
      </div>
    </aside>
  </div>

  <!-- ================= RESULTS (filled by app.fs.js) ================= -->
  <section id="results" hidden style="margin-top:16px">
    <h2 id="outHeader"></h2>

    <label class="oh-label" for="outReason">Reason for exam</label>
    <textarea id="outReason" class="oh-input" rows="3"></textarea>

    <div class="oh-grid" style="margin-top:12px">
      <div>
        <h3>Prep / Contraindications</h3>
        <ul id="outPrep"></ul>
      </div>
      <div>
        <h3>Supporting Docs</h3>
        <ul id="outDocs"></ul>
      </div>
      <div>
        <h3>Clinical Flags</h3>
        <ul id="outFlags"></ul>
      </div>
      <div>
        <h3>ICD-10 Suggestions</h3>
        <ul id="outICD"></ul>
      </div>
    </div>

    <div class="actions">
      <button id="copyReasonBtn" type="button" class="btn btn-light">Copy Reason</button>
      <button id="copyAllBtn" type="button" class="btn btn-secondary">Copy All</button>
      <button id="printBtn" type="button" class="btn btn-tertiary">Print</button>
    </div>
  </section>

  <!-- Debug note (Firestore now) -->
  <details id="rulesInfo" style="margin-top:1rem" hidden>
    <summary>What rules are applied?</summary>
    <p>
      Rules load from Firestore at <code>/published_rules/{modality}/records</code> (read-only).  
      Admins can publish from the secure editor. No local <code>rules.json</code> is used.
    </p>
  </details>
  <script>
    if (new URLSearchParams(location.search).get('debug') === '1') {
      const d = document.getElementById('rulesInfo'); if (d) d.hidden = false;
    }
  </script>

  <noscript>
    <p class="status error">JavaScript is required for the Order Helper to function.</p>
  </noscript>
</section>

<!-- Boot loader: config → SDKs → app.fs.js (Firestore-only) -->
<script>
(async function boot() {
  const set = (m, cls='status success') => {
    const s = document.getElementById('status');
    if (s) { s.textContent = m; s.className = cls; }
  };

  function loadScript(src) {
    return new Promise((res, rej) => {
      const sc = document.createElement('script');
      sc.src = src; sc.onload = res; sc.onerror = () => rej(new Error('Failed to load: ' + src));
      document.head.appendChild(sc);
    });
  }

  try {
    // 1) Config: hosted, then local fallback
    try { await loadScript('https://auth.oradigit.com/oh-public/firebase-config.js'); } catch {}
    if (!window.ORADIGIT_FIREBASE_CONFIG && !window.FIREBASE_CONFIG) {
      await loadScript("{{ '/order-helper/admin/firebase-config.js' | relative_url }}");
    }
    if (!window.ORADIGIT_FIREBASE_CONFIG && !window.FIREBASE_CONFIG) {
      throw new Error('Firebase config not found');
    }

    // 2) SDKs (Compat)
    await loadScript('https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js');
    await loadScript('https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js');

    // 3) Init
    const cfg = window.ORADIGIT_FIREBASE_CONFIG || window.FIREBASE_CONFIG;
    if (!firebase.apps.length) firebase.initializeApp(cfg);
    window.OH_FIREBASE = { app: firebase.app(), db: firebase.firestore() };
    set('Firebase ready.', 'status success');

    // 4) App (Firestore-only)
    <script defer src="{{ '/order-helper/app.js' | relative_url }}?v=20250922"></script>

  } catch (e) {
    console.error(e);
    set('Init error: ' + e.message, 'status error');
  }
})();
</script>
